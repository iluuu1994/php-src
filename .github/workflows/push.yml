#############################################################
#   WARNING: automatically generated file, DO NOT CHANGE!   #
#############################################################

# This file was automatically generated. Adjust and run the
# .github/generate_ci.php file to make changes to the
# pipeline.

---
name: Push
"on":
  push:
    paths-ignore:
    - docs/*
    - NEWS
    - UPGRADING
    - UPGRADING.INTERNALS
    - README.md
    - CONTRIBUTING.md
    - CODING_STANDARDS.md
jobs:
  test:
    needs: generate-matrix
    strategy:
      matrix:
        include:
        - arch: linux-x64
          debug: true
          zts: false
        - arch: linux-x64
          debug: false
          zts: true
        - arch: macos
          debug: true
          zts: false
      fail-fast: false
    name: ${{ matrix.arch }}-${{ matrix.debug && "debug" || "release" }}-${{ matrix.zts
      && "zts" || "nts" }}
    runs-on: ${{ startsWith(matrix.arch, "linux-") && "ubuntu-20.04" || "macOS-10.15"
      }}
    env:
      ARCH: ${{ matrix.arch }}
    steps:
    - name: git checkout
      uses: actions/checkout@v2
    - name: Create mssql container
      if: env.ARCH != "macos"
      uses: ./.github/actions/mssql
    - name: Install dependencies
      uses: ./.github/actions/deps
    - name: ./configure
      uses: ./.github/actions/configure
      with:
        configuration-parameters: |2-
              --${{ inputs.debug && "enable" || "disable" }}-debug \\
              --${{ inputs.zts && "enable" || "disable" }}-zts
    - name: make
      run: |2-
            if [ "$ARCH" == "macos" ]; then
                export PATH="/usr/local/opt/bison/bin:$PATH"
            fi
            make -j$(${{ env.ARCH != 'macos' && '/usr/bin/nproc' || 'sysctl -n hw.logicalcpu' }}) >/dev/null
    - name: make install
      uses: ./.github/actions/install
    - name: Setup
      uses: ./.github/actions/setup
    - name: Test
      uses: ./.github/actions/test
    - name: Tracing JIT
      uses: ./.github/actions/test
      with:
        run-tests-parameters: |2-
              -d zend_extension=opcache.so \
              -d opcache.jit_buffer_size=16M
              ${{ env.ARCH == "macos" && "-d opcache.protect_memory=1" }}
...
